<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>세븐나이츠 길드원 명부</title>
  <style>
    :root { --bg:#0b0f17; --card:#101828; --muted:#9aa4b2; --text:#e6eaf0; --accent:#66d9e8; --accent2:#7c3aed; }
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;background:linear-gradient(180deg,#0b0f17,#111827);color:var(--text)}
    .container{max-width:1100px;margin:40px auto;padding:0 16px}
    .header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .title{font-weight:800;font-size:28px;letter-spacing:-0.3px}
    .sub{color:var(--muted);font-size:14px}
    .card{background:rgba(16,24,40,.9);backdrop-filter:saturate(140%) blur(8px);border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .controls{display:flex;gap:10px;flex-wrap:wrap;padding:14px}
    input,select,button,label{font:inherit}
    .input{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:#0e1523;color:var(--text)}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:#0e1523;color:var(--text);cursor:pointer}
    .btn:hover{border-color:rgba(255,255,255,.18)}
    .btn-primary{background:linear-gradient(135deg,var(--accent),#22b8cf);color:#002129;border:none}
    .btn-primary:hover{filter:brightness(1.05)}
    .btn-ghost{background:transparent;border:1px dashed rgba(255,255,255,.25)}
    table{width:100%;border-collapse:collapse}
    thead th{position:sticky;top:0;background:#0f172a;color:#b8c0cc;font-size:12px;text-transform:uppercase;letter-spacing:.06em;border-bottom:1px solid rgba(255,255,255,.06);padding:12px;text-align:left}
    tbody td{padding:12px;border-bottom:1px solid rgba(255,255,255,.06)}
    tbody tr:hover{background:rgba(255,255,255,.03)}
    .pill{padding:4px 8px;border-radius:999px;font-size:12px}
    .pill.green{background:rgba(34,197,94,.15);color:#4ade80}
    .pill.gray{background:rgba(148,163,184,.15);color:#cbd5e1}
    .pill.purple{background:rgba(168,85,247,.15);color:#c084fc}
    .toolbar{display:flex;gap:8px;align-items:center}
    .footer{color:var(--muted);font-size:12px;padding:12px 14px}
    .count{color:#a5b4fc;font-weight:700}
    .nowrap{white-space:nowrap}
    .muted{color:var(--muted)}
    .badge{background:rgba(125,211,252,.12);color:#93c5fd;border:1px solid rgba(147,197,253,.25);padding:2px 6px;border-radius:8px;font-size:11px}
    .table-wrap{border-radius:16px;overflow:hidden}
    .hidden{display:none}
    .row-actions{display:flex;gap:6px}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);padding:16px}
    .modal .panel{max-width:560px;width:100%;padding:16px}
    .modal.open{display:flex}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    .grid-1{display:grid;grid-template-columns:1fr;gap:10px}
    .help{font-size:12px;color:#9aa4b2}
      .tabs{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    .tab{padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.1);background:#0e1523;color:var(--text);cursor:pointer}
    .tab.active{background:linear-gradient(135deg,var(--accent),#22b8cf);color:#002129;border:none}
    .section{display:none}
    .section.active{display:block}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <div class="title">스타 길드 – 길드원 명부</div>
        <div class="sub">Seven Knights | 실시간 검색 · 정렬 · 가져오기/내보내기 지원</div>
      </div>
      <div class="toolbar">
        <button class="btn" id="importBtn">가져오기(JSON)</button>
        <button class="btn" id="exportBtn">내보내기(JSON)</button>
        <button class="btn btn-primary" id="addBtn">+ 길드원 추가</button>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" id="tabRoster">명부</button>
      <button class="tab" id="tabGuides">가이드</button>
      <button class="btn btn-ghost" id="editLinks">링크 설정</button>
    </div>
        <div class="sub">Seven Knights | 실시간 검색 · 정렬 · 가져오기/내보내기 지원</div>
      </div>
      <div class="toolbar">
        <button class="btn" id="importBtn">가져오기(JSON)</button>
        <button class="btn" id="exportBtn">내보내기(JSON)</button>
        <button class="btn btn-primary" id="addBtn">+ 길드원 추가</button>
      </div>
    </div>

    <section id="sec-roster" class="section active">
    <div class="card" style="margin-top:16px">
      <div class="controls">
        <input id="q" class="input" placeholder="검색: 닉네임/포지션/메모/디스코드" style="min-width:260px"/>
        <select id="filterActive" class="input">
          <option value="">활동 상태(전체)</option>
          <option value="활동">활동</option>
          <option value="휴식">휴식</option>
        </select>
        <select id="filterWar" class="input">
          <option value="">길드전(전체)</option>
          <option value="참여">참여</option>
          <option value="미참여">미참여</option>
        </select>
        <select id="sortBy" class="input">
          <option value="nickname">정렬: 닉네임</option>
          <option value="level">정렬: 레벨</option>
          <option value="lastLogin">정렬: 마지막 접속</option>
        </select>
        <select id="sortDir" class="input">
          <option value="asc">오름차순</option>
          <option value="desc">내림차순</option>
        </select>
        <span class="badge" id="countBadge">0명</span>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>닉네임</th>
              <th class="nowrap">레벨</th>
              <th>포지션</th>
              <th>활동</th>
              <th>길드전</th>
              <th>디스코드</th>
              <th>마지막 접속</th>
              <th>메모</th>
              <th>관리</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div class="footer">* 팁: JSON을 내보내서 보관/백업하고, 다음에 가져오기 버튼으로 다시 불러올 수 있어요.</div>
    </div>
  </section>

  <section id="sec-guides" class="section">
    <div class="card" style="margin-top:16px;padding:18px">
      <div class="title" style="font-size:22px;margin-bottom:6px">길드전 & 공성전 가이드</div>
      <div class="sub">링크로 바로 열리며, 필요하면 설명을 아래에 적어 둘 수 있어요.</div>

      <div class="grid" style="margin-top:14px">
        <div class="card" style="padding:16px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="title" style="font-size:18px">길드전 가이드</div>
              <div class="muted" id="warDesc">시트로 정리된 공략/규칙</div>
            </div>
            <a id="warLink" class="btn btn-primary" href="#" target="_blank" rel="noopener">시트 열기</a>
          </div>
        </div>
        <div class="card" style="padding:16px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="title" style="font-size:18px">공성전 가이드</div>
              <div class="muted" id="siegeDesc">길드 내부 기준/루트/팁</div>
            </div>
            <a id="siegeLink" class="btn" href="#" target="_blank" rel="noopener">링크 열기</a>
          </div>
        </div>
      </div>

      <div class="footer">※ “링크 설정” 버튼으로 각 가이드 주소를 변경할 수 있어요.</div>
    </div>
  </section>

  </div>

  <!-- Add/Edit Modal -->
  <div class="modal" id="modal">
    <div class="card panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div class="title" style="font-size:20px" id="modalTitle">길드원 추가</div>
        <button class="btn" id="closeModal">닫기</button>
      </div>
      <div class="grid">
        <label class="grid-1">닉네임<input class="input" id="f_nickname" required></label>
        <label>레벨<input class="input" id="f_level" type="number" min="1" value="1"></label>
        <label>포지션<input class="input" id="f_role" placeholder="예: 딜러 / 탱커"></label>
        <label>활동<select class="input" id="f_active"><option>활동</option><option>휴식</option></select></label>
        <label>길드전<select class="input" id="f_war"><option>참여</option><option>미참여</option></select></label>
        <label>디스코드<input class="input" id="f_discord" placeholder="예: hyoseop#1234"></label>
        <label class="grid-1">마지막 접속<input class="input" id="f_last" type="date"></label>
        <label class="grid-1">메모<input class="input" id="f_note" placeholder="예: 출석 우수/뉴비"></label>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn" id="deleteBtn" class="hidden">삭제</button>
        <button class="btn btn-primary" id="saveBtn">저장</button>
      </div>
      <div class="help">날짜는 <b>YYYY-MM-DD</b> 형식으로 저장됩니다.</div>
    </div>
  </div>

  <input id="fileInput" type="file" accept="application/json" class="hidden" />

  <script>
    // --- Guide Links (처음엔 예시, '링크 설정'으로 변경) ---
    let GUIDE_WAR_URL = 'https://docs.google.com/spreadsheets/d/예시';
    let GUIDE_SIEGE_URL = '';

    // --- Demo data (수정해서 사용하세요) ---
    let members = [
      { id: crypto.randomUUID(), nickname:"소라카", level:80, role:"힐러", active:"활동", war:"참여", discord:"soraka#7777", lastLogin:"2025-09-02", note:"주 5일 접속" },
      { id: crypto.randomUUID(), nickname:"야스오", level:78, role:"딜러", active:"활동", war:"미참여", discord:"yasuo#1111", lastLogin:"2025-08-30", note:"복귀" },
      { id: crypto.randomUUID(), nickname:"브라움", level:82, role:"탱커", active:"휴식", war:"미참여", discord:"braum#2222", lastLogin:"2025-08-10", note:"개인사정" },
    ];

    // --- State ---
    let editingId = null;

    // --- Helpers ---
    function fmtDate(d){ if(!d) return ""; const x=new Date(d); if(isNaN(x)) return d; return x.toISOString().slice(0,10); }
    function compare(a,b){ return a<b?-1:a>b?1:0 }

    // --- Render ---
    function render(){
      const q = document.querySelector('#q').value.trim().toLowerCase();
      const fActive = document.querySelector('#filterActive').value;
      const fWar = document.querySelector('#filterWar').value;
      const sortBy = document.querySelector('#sortBy').value;
      const dir = document.querySelector('#sortDir').value;

      let rows = members.filter(m => {
        const bag = [m.nickname,m.role,m.note,m.discord].join(' ').toLowerCase();
        const passQ = !q || bag.includes(q);
        const passA = !fActive || m.active===fActive;
        const passW = !fWar || m.war===fWar;
        return passQ && passA && passW;
      }).sort((a,b)=>{
        let va=a[sortBy], vb=b[sortBy];
        if(sortBy==='level'){ va=Number(va)||0; vb=Number(vb)||0; }
        if(sortBy==='lastLogin'){ va=fmtDate(va); vb=fmtDate(vb); }
        const r = compare(va,vb); return dir==='asc'?r:-r;
      });

      document.querySelector('#countBadge').textContent = `${rows.length}명`;

      const tbody = document.querySelector('#tbody');
      tbody.innerHTML = rows.map(m=> `
        <tr>
          <td><b>${m.nickname}</b></td>
          <td class="nowrap">${m.level}</td>
          <td>${m.role||''}</td>
          <td><span class="pill ${m.active==='활동'?'green':'gray'}">${m.active}</span></td>
          <td><span class="pill ${m.war==='참여'?'purple':'gray'}">${m.war}</span></td>
          <td class="nowrap">${m.discord||''}</td>
          <td class="nowrap">${fmtDate(m.lastLogin)||''}</td>
          <td class="muted">${m.note||''}</td>
          <td>
            <div class="row-actions">
              <button class="btn" onclick="openEdit('${m.id}')">수정</button>
              <button class="btn btn-ghost" onclick="removeMember('${m.id}')">삭제</button>
            </div>
          </td>
        </tr>`).join('');
    }

    // --- CRUD ---
    function openAdd(){ editingId=null; document.querySelector('#modalTitle').textContent='길드원 추가';
      ['nickname','level','role','active','war','discord','last','note'].forEach(k=>document.querySelector('#f_'+k).value='');
      document.querySelector('#deleteBtn').style.display='none'; toggleModal(true);
    }
    function openEdit(id){
      const m = members.find(x=>x.id===id); if(!m) return;
      editingId = id; document.querySelector('#modalTitle').textContent='길드원 수정';
      document.querySelector('#f_nickname').value=m.nickname||'';
      document.querySelector('#f_level').value=m.level||'';
      document.querySelector('#f_role').value=m.role||'';
      document.querySelector('#f_active').value=m.active||'활동';
      document.querySelector('#f_war').value=m.war||'참여';
      document.querySelector('#f_discord').value=m.discord||'';
      document.querySelector('#f_last').value=fmtDate(m.lastLogin)||'';
      document.querySelector('#f_note').value=m.note||'';
      document.querySelector('#deleteBtn').style.display='inline-flex';
      toggleModal(true);
    }
    function save(){
      const m = {
        nickname: document.querySelector('#f_nickname').value.trim(),
        level: Number(document.querySelector('#f_level').value||'0'),
        role: document.querySelector('#f_role').value.trim(),
        active: document.querySelector('#f_active').value,
        war: document.querySelector('#f_war').value,
        discord: document.querySelector('#f_discord').value.trim(),
        lastLogin: document.querySelector('#f_last').value.trim(),
        note: document.querySelector('#f_note').value.trim(),
      };
      if(!m.nickname){ alert('닉네임은 필수입니다.'); return; }
      if(editingId){ const i = members.findIndex(x=>x.id===editingId); members[i] = { id:editingId, ...m }; }
      else { members.unshift({ id: crypto.randomUUID(), ...m }); }
      toggleModal(false); render();
    }
    function removeMember(id){ if(!confirm('삭제할까요?')) return; members = members.filter(x=>x.id!==id); render(); }

    // --- Import/Export ---
    function exportJSON(){
      const blob = new Blob([JSON.stringify(members,null,2)], {type:'application/json'});
      const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='guild_members.json'; a.click(); URL.revokeObjectURL(a.href);
    }
    function importJSON(file){
      const reader = new FileReader();
      reader.onload = e=>{ try{ const data = JSON.parse(e.target.result); if(Array.isArray(data)){ members = data.map(x=>({ id: x.id||crypto.randomUUID(), ...x })); render(); } else alert('JSON 배열 형식이 아닙니다.'); } catch(err){ alert('불러오기 실패: '+err.message); } };
      reader.readAsText(file);
    }

    // --- Modal ---
    function toggleModal(open){ document.querySelector('#modal').classList.toggle('open', !!open); }

      // --- View Switch ---
    function showSection(which){
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      document.querySelector('#sec-'+which).classList.add('active');
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.querySelector('#tab'+which.charAt(0).toUpperCase()+which.slice(1)).classList.add('active');
    }
    function refreshGuideLinks(){
      const warA = document.querySelector('#warLink');
      const siegeA = document.querySelector('#siegeLink');
      warA.href = GUIDE_WAR_URL || '#';
      siegeA.href = GUIDE_SIEGE_URL || '#';
      warA.className = GUIDE_WAR_URL? 'btn btn-primary':'btn';
      siegeA.className = GUIDE_SIEGE_URL? 'btn btn-primary':'btn';
    }

    // --- Events ---
    document.querySelector('#q').addEventListener('input', render);
    ['filterActive','filterWar','sortBy','sortDir'].forEach(id=> document.querySelector('#'+id).addEventListener('change', render));
    document.querySelector('#addBtn').addEventListener('click', openAdd);
    document.querySelector('#saveBtn').addEventListener('click', save);
    document.querySelector('#closeModal').addEventListener('click', ()=>toggleModal(false));
    document.querySelector('#deleteBtn').addEventListener('click', ()=>{ if(!editingId) return; removeMember(editingId); toggleModal(false); });
    document.querySelector('#exportBtn').addEventListener('click', exportJSON);
    document.querySelector('#importBtn').addEventListener('click', ()=> document.querySelector('#fileInput').click());
    document.querySelector('#fileInput').addEventListener('change', e=>{ const f=e.target.files?.[0]; if(f) importJSON(f); e.target.value=''; });

    // Tabs
    document.querySelector('#tabRoster').addEventListener('click', ()=>showSection('roster'));
    document.querySelector('#tabGuides').addEventListener('click', ()=>{ showSection('guides'); refreshGuideLinks(); });

    // Link setup
    document.querySelector('#editLinks').addEventListener('click', ()=>{
      const war = prompt('길드전 가이드 시트 URL?', GUIDE_WAR_URL || '');
      if(war!==null) GUIDE_WAR_URL = war.trim();
      const siege = prompt('공성전 가이드 URL(없으면 비워두기)?', GUIDE_SIEGE_URL || '');
      if(siege!==null) GUIDE_SIEGE_URL = siege.trim();
      refreshGuideLinks();
      if(document.querySelector('#sec-guides').classList.contains('active')){
        alert('링크가 업데이트되었습니다. 버튼을 눌러 열어보세요.');
      }
    }); e.target.value=''; });

    // First paint
    render();
    refreshGuideLinks();
  </script>
</body>
</html>
